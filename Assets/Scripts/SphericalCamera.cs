using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class SphericalCamera : MonoBehaviour
{
    public Transform playerTransform;           //?????? ?????? ???????? ???? ???????? ????????

    public Transform target;                    //???????? ?????? ????
    public float distance = 1.0f;              //?????????????? ????
    public float mouseSensitivity = 100.0f;     //?????? ????
    public float scrollScsitivity = 2.0f;       //?????? ????
    public float minYAngle = 5.0f;              //???? ???? ????
    public float maxYAngle = 85.0f;             //???? ???? ????

    private float currentHorizontalAngle = 0.0f;            //???? ???? ????
    private float currentVerticalAngle = 0f;              //???? ???? ????

    void Start()
    {
        Cursor.lockState = CursorLockMode.Locked;
    }


    void Update()
    {
        if (target != null)
        {
            HandleInput();
            UpdateCameraPosition();
            Vector3 targetRotation = new Vector3(transform.forward.x, 0, transform.forward.z).normalized;
            playerTransform.forward = targetRotation;
        }
    }

    private void HandleInput()
    {
        //?????? ?????? ???? ???? ????
        currentHorizontalAngle -= Input.GetAxis("Mouse X") * mouseSensitivity * Time.deltaTime;
        currentVerticalAngle += Input.GetAxis("Mouse Y") * mouseSensitivity * Time.deltaTime;
        currentVerticalAngle = Mathf.Clamp(currentVerticalAngle, minYAngle, maxYAngle);         //???? ?????????? ???? ?????? ??????.

        //???????? ???? ???? ????
        distance += -Input.GetAxis("Mouse ScrollWheel") * scrollScsitivity;
        distance = Mathf.Clamp(distance, 0.5f, 2.0f);                             //???? ????
    }

    private void UpdateCameraPosition()
    {
        //???? ???????? ?????? ???? ????
        float verticalAngleRadians = currentVerticalAngle * Mathf.Deg2Rad;                  //?????? ?????????? ????
        float horizontalAngleRaians = currentHorizontalAngle * Mathf.Deg2Rad;

        float x = distance * Mathf.Sin(verticalAngleRadians) * Mathf.Cos(horizontalAngleRaians);
        float z = distance * Mathf.Sin(verticalAngleRadians) * Mathf.Sin(horizontalAngleRaians);
        float y = distance * Mathf.Cos(verticalAngleRadians);

        Vector3 newPosition = new Vector3(x, y, z);
        newPosition = target.position + newPosition;

        //???? ???????? ?? ?????? ????
        transform.position = newPosition;// Vector3.Lerp(transform.position, newPosition, Time.deltaTime * 6);     //???? ???? ????
        transform.LookAt(target);
    }
}
